<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Balancer - Rijksbegroting Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #FF6B35;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .balance-indicator {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }



        .balance-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .balance-card {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .balance-card.uitgaven {
            background: #ffe6e6;
            border-left: 4px solid #ff4757;
        }

        .balance-card.inkomsten {
            background: #e6f7ff;
            border-left: 4px solid #2f54eb;
        }

        .balance-card.resultaat {
            background: #f6ffed;
            border-left: 4px solid #52c41a;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .uitgaven-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .inkomsten-panel {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .panel-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 3px solid #FF6B35;
            padding-bottom: 10px;
        }

        .theme-selection {
            margin-bottom: 30px;
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .theme-card {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .theme-card:hover {
            border-color: #FF6B35;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.2);
        }

        .theme-card.selected {
            border-color: #FF6B35;
            background: #fff0eb;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        .theme-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        .theme-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .theme-description {
            font-size: 0.9rem;
            color: #666;
        }

        .budget-sliders {
            display: none;
        }

        .budget-sliders.active {
            display: block;
        }

        .budget-item {
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #FF6B35;
            position: relative;
        }

        .budget-item.comparison-mode {
            border-left: 4px solid #2f54eb;
        }

        .comparison-bar {
            position: absolute;
            top: 0;
            right: 0;
            width: 6px;
            background: rgba(47, 84, 235, 0.6);
            border-radius: 0 10px 10px 0;
            transition: height 0.3s ease;
        }

        .comparison-tooltip {
            position: absolute;
            right: 15px;
            top: 15px;
            background: #2f54eb;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .budget-item:hover .comparison-tooltip {
            opacity: 1;
        }

        .budget-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .budget-item-name {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .budget-item-amount {
            font-weight: bold;
            color: #FF6B35;
            font-size: 1.2rem;
            margin-left: 10px;
        }

        .slider-container {
            margin-top: 10px;
        }

        .budget-slider {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .budget-slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #FF6B35;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .budget-slider::-webkit-slider-thumb:hover {
            background: #e55a2b;
            transform: scale(1.1);
        }

        .inkomsten-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #2f54eb;
        }

        .inkomsten-name {
            font-weight: 600;
            color: #333;
            flex: 1;
        }

        .inkomsten-amount {
            font-weight: bold;
            color: #2f54eb;
            font-size: 1.1rem;
        }

        .chart-container {
            margin-top: 30px;
            height: 300px;
        }

        .actions {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 30px;
            text-align: center;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .btn-primary {
            background: #FF6B35;
            color: white;
        }

        .btn-primary:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .surplus {
            color: #52c41a !important;
        }

        .deficit {
            color: #ff4757 !important;
        }

        .balanced {
            color: #2f54eb !important;
        }

        .selection-prompt {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .balance-info {
                grid-template-columns: 1fr;
            }
            
            .theme-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .balance-scale {
                flex-direction: column;
                gap: 20px;
            }
            
            .scale-center {
                margin: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Budget Balancer</h1>
            <p>Kies 5 thema's en stel jouw ideale Nederlandse rijksbegroting samen</p>
        </div>

        <div class="balance-indicator">
            <div class="balance-info">
                <div class="balance-card uitgaven">
                    <h3>Totale Uitgaven</h3>
                    <p id="totaalUitgaven">‚Ç¨ 0,0 miljard</p>
                </div>
                <div class="balance-card inkomsten">
                    <h3>Totale Inkomsten</h3>
                    <p id="totaalInkomsten">‚Ç¨ 451,4 miljard</p>
                </div>
                <div class="balance-card resultaat">
                    <h3>Resultaat</h3>
                    <p id="budgetResultaat" class="surplus">‚Ç¨ +451,4 miljard</p>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="uitgaven-panel">
                <h2 class="panel-title">üéØ Kies 5 Thema's voor jouw Begroting</h2>
                
                <div class="theme-selection">
                    <div class="theme-grid" id="themeGrid">
                        <!-- Themes will be populated by JavaScript -->
                    </div>
                    <p style="text-align: center; margin-top: 20px; color: #666;">
                        <span id="selectedCount">0</span>/5 thema's geselecteerd
                    </p>
                </div>

                <div class="budget-sliders" id="budgetSliders">
                    <h3 style="margin-bottom: 20px; color: #333;">üí∞ Verdeel het Budget</h3>
                    <div id="sliderContainer">
                        <!-- Sliders will be populated by JavaScript -->
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="uitgavenChart"></canvas>
                </div>
            </div>

            <div class="inkomsten-panel">
                <h2 class="panel-title">üíº Inkomsten</h2>
                <div id="inkomstenList"></div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-secondary" onclick="resetBudget()">üîÑ Reset</button>
            <button class="btn btn-primary" onclick="toggleComparison()" id="comparisonBtn">üëÅÔ∏è Toon Werkelijke Begroting</button>
            <button class="btn btn-primary" onclick="exportToPDF()">üìÑ Download PDF</button>
        </div>
    </div>

    <script>
        // Thema definities met geaggregeerde bedragen uit rijksbegroting 2026
        const themes = [
            {
                id: 'zorg_welzijn',
                name: 'Zorg & Welzijn',
                icon: 'üè•',
                description: 'Zorg, Sociale Zekerheid, Arbeidsmarkt',
                realBudget: 244.2, // Zorg (119.5) + Sociale Zekerheid (124.7)
                categories: ['Zorg', 'Sociale Zekerheid en Arbeidsmarkt']
            },
            {
                id: 'onderwijs_cultuur',
                name: 'Onderwijs & Cultuur',
                icon: 'üìö',
                description: 'Onderwijs, Wetenschap, Cultuur',
                realBudget: 54.8,
                categories: ['Onderwijs, Cultuur en Wetenschap']
            },
            {
                id: 'veiligheid_defensie',
                name: 'Veiligheid & Defensie',
                icon: 'üõ°Ô∏è',
                description: 'Defensie, Politie, Justitie, Buitenlandse Zaken',
                realBudget: 66.8, // Defensie (34.5) + Justitie (16.8) + Buitenlandse Zaken (15.5)
                categories: ['Defensie', 'Justitie en Veiligheid', 'Buitenlandse Zaken en Ontwikkelingshulp']
            },
            {
                id: 'infrastructuur_wonen',
                name: 'Infrastructuur & Wonen',
                icon: 'üèóÔ∏è',
                description: 'Wegen, Openbaar Vervoer, Woningbouw',
                realBudget: 23.7, // Infrastructuur (14.9) + Volkshuisvesting (8.8)
                categories: ['Infrastructuur en Waterstaat', 'Volkshuisvesting en Ruimtelijke Ordening']
            },
            {
                id: 'klimaat_natuur',
                name: 'Klimaat & Natuur',
                icon: 'üå±',
                description: 'Klimaat, Milieu, Landbouw, Natuur',
                realBudget: 8.3, // Klimaat (4.1) + Landbouw (4.2)
                categories: ['Klimaat en Groene Groei', 'Landbouw, Visserij, Voedselzekerheid en Natuur']
            },
            {
                id: 'economie_innovatie',
                name: 'Economie & Innovatie',
                icon: 'üíº',
                description: 'Economische Zaken, Innovatie, Handel',
                realBudget: 2.9, // Economische Zaken
                categories: ['Economische Zaken']
            },
            {
                id: 'bestuur_financien',
                name: 'Bestuur & Financi√´n',
                icon: 'üèõÔ∏è',
                description: 'Overheidsapparaat, Financieel Beleid',
                realBudget: 69.8, // Gemeentefonds (56.6) + Rentelasten (9.5) + Financi√´n (3.5) + Overig (4.2)
                categories: ['Gemeentefonds, Provinciefonds en Btw-compensatiefonds', 'Rentelasten', 'Financi√´n', 'Overig']
            },
            {
                id: 'migratie_integratie',
                name: 'Migratie & Integratie',
                icon: 'ü§ù',
                description: 'Asiel, Migratie, Integratie',
                realBudget: 8.9,
                categories: ['Asiel en Migratie']
            }
        ];

        const inkomsten = [
            { naam: 'Loon- en inkomstenbelasting', bedrag: 110.3 },
            { naam: 'Omzetbelasting (btw)', bedrag: 87.8 },
            { naam: 'Zorgpremies', bedrag: 61.4 },
            { naam: 'Vennootschapsbelasting', bedrag: 49.7 },
            { naam: 'Premies volksverzekeringen', bedrag: 44.9 },
            { naam: 'Premies werknemersverzekeringen', bedrag: 43.5 },
            { naam: 'Overige belastingen en inkomsten', bedrag: 53.8 }
        ];

        let selectedThemes = [];
        let budgetAllocations = {};
        let comparisonMode = false;
        let uitgavenChart = null;

        function initApp() {
            renderThemes();
            renderInkomsten();
            updateBalanceDisplay();
        }

        function renderThemes() {
            const container = document.getElementById('themeGrid');
            container.innerHTML = '';

            themes.forEach(theme => {
                const div = document.createElement('div');
                div.className = selectedThemes.includes(theme.id) ? 'theme-card selected' : 'theme-card';
                div.onclick = () => toggleTheme(theme.id);
                
                div.innerHTML = `
                    <span class="theme-icon">${theme.icon}</span>
                    <div class="theme-name">${theme.name}</div>
                    <div class="theme-description">${theme.description}</div>
                    ${comparisonMode ? `<div style="margin-top: 10px; font-weight: bold; color: #2f54eb;">Werkelijk: ‚Ç¨${theme.realBudget.toFixed(1)}B</div>` : ''}
                `;
                
                container.appendChild(div);
            });

            document.getElementById('selectedCount').textContent = selectedThemes.length;
        }

        function toggleTheme(themeId) {
            const index = selectedThemes.indexOf(themeId);
            
            if (index > -1) {
                // Remove theme
                selectedThemes.splice(index, 1);
                delete budgetAllocations[themeId];
            } else if (selectedThemes.length < 5) {
                // Add theme
                selectedThemes.push(themeId);
                budgetAllocations[themeId] = 0;
            }
            
            renderThemes();
            renderBudgetSliders();
            updateBalanceDisplay();
            updateChart();
        }

        function renderBudgetSliders() {
            const container = document.getElementById('sliderContainer');
            const slidersSection = document.getElementById('budgetSliders');
            
            if (selectedThemes.length === 0) {
                slidersSection.classList.remove('active');
                return;
            }
            
            slidersSection.classList.add('active');
            container.innerHTML = '';

            // Render selected themes
            selectedThemes.forEach(themeId => {
                const theme = themes.find(t => t.id === themeId);
                const amount = budgetAllocations[themeId] || 0;
                
                const div = document.createElement('div');
                div.className = comparisonMode ? 'budget-item comparison-mode' : 'budget-item';
                
                const comparisonBarHeight = comparisonMode ? (theme.realBudget / 125 * 100) : 0;
                
                div.innerHTML = `
                    <div class="budget-item-header">
                        <span class="budget-item-name">${theme.icon} ${theme.name}</span>
                        <span class="budget-item-amount">‚Ç¨ ${amount.toFixed(1)}B</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" 
                               class="budget-slider" 
                               id="slider_${themeId}"
                               min="0" 
                               max="125" 
                               value="${amount}" 
                               step="0.1"
                               onchange="updateBudget('${themeId}', this.value)">
                    </div>
                    ${comparisonMode ? `
                        <div class="comparison-bar" style="height: ${comparisonBarHeight}%"></div>
                        <div class="comparison-tooltip">Werkelijk: ‚Ç¨${theme.realBudget.toFixed(1)}B</div>
                    ` : ''}
                `;
                container.appendChild(div);
            });

            // Add "Overig" category if themes are selected
            if (selectedThemes.length > 0) {
                const overigAmount = budgetAllocations['overig'] || 0;
                const overigRealBudget = calculateOverigRealBudget();
                
                const div = document.createElement('div');
                div.className = comparisonMode ? 'budget-item comparison-mode' : 'budget-item';
                
                const comparisonBarHeight = comparisonMode ? (overigRealBudget / 125 * 100) : 0;
                
                div.innerHTML = `
                    <div class="budget-item-header">
                        <span class="budget-item-name">üì¶ Overig</span>
                        <span class="budget-item-amount">‚Ç¨ ${overigAmount.toFixed(1)}B</span>
                    </div>
                    <div class="slider-container">
                        <input type="range" 
                               class="budget-slider" 
                               id="slider_overig"
                               min="0" 
                               max="125" 
                               value="${overigAmount}" 
                               step="0.1"
                               onchange="updateBudget('overig', this.value)">
                    </div>
                    ${comparisonMode ? `
                        <div class="comparison-bar" style="height: ${comparisonBarHeight}%"></div>
                        <div class="comparison-tooltip">Werkelijk: ‚Ç¨${overigRealBudget.toFixed(1)}B</div>
                    ` : ''}
                `;
                container.appendChild(div);
            }
        }

        function calculateOverigRealBudget() {
            const totalRealBudget = 486.3; // Total from rijksbegroting
            const selectedThemesRealBudget = selectedThemes.reduce((sum, themeId) => {
                const theme = themes.find(t => t.id === themeId);
                return sum + theme.realBudget;
            }, 0);
            return totalRealBudget - selectedThemesRealBudget;
        }

        function updateBudget(id, value) {
            budgetAllocations[id] = parseFloat(value);
            
            // Update display
            const amountSpan = document.querySelector(`#slider_${id}`).parentNode.parentNode.querySelector('.budget-item-amount');
            amountSpan.textContent = `‚Ç¨ ${parseFloat(value).toFixed(1)}B`;
            
            updateBalanceDisplay();
            updateChart();
        }

        function updateBalanceDisplay() {
            const totaalUitgaven = Object.values(budgetAllocations).reduce((sum, amount) => sum + amount, 0);
            const totaalInkomsten = inkomsten.reduce((sum, item) => sum + item.bedrag, 0);
            const resultaat = totaalInkomsten - totaalUitgaven;

            document.getElementById('totaalUitgaven').textContent = `‚Ç¨ ${totaalUitgaven.toFixed(1)} miljard`;
            document.getElementById('totaalInkomsten').textContent = `‚Ç¨ ${totaalInkomsten.toFixed(1)} miljard`;
            
            const resultaatElement = document.getElementById('budgetResultaat');
            resultaatElement.textContent = `‚Ç¨ ${resultaat >= 0 ? '+' : ''}${resultaat.toFixed(1)} miljard`;
            
            // Update classes for color coding
            resultaatElement.className = '';
            if (Math.abs(resultaat) < 1) {
                resultaatElement.classList.add('balanced');
            } else if (resultaat > 0) {
                resultaatElement.classList.add('surplus');
            } else {
                resultaatElement.classList.add('deficit');
            }
        }



        function renderInkomsten() {
            const container = document.getElementById('inkomstenList');
            container.innerHTML = '';

            inkomsten.forEach(item => {
                const div = document.createElement('div');
                div.className = 'inkomsten-item';
                div.innerHTML = `
                    <span class="inkomsten-name">${item.naam}</span>
                    <span class="inkomsten-amount">‚Ç¨ ${item.bedrag.toFixed(1)}B</span>
                `;
                container.appendChild(div);
            });
        }

        function updateChart() {
            const ctx = document.getElementById('uitgavenChart');
            
            if (selectedThemes.length === 0) {
                if (uitgavenChart) {
                    uitgavenChart.destroy();
                    uitgavenChart = null;
                }
                return;
            }

            const labels = [];
            const data = [];
            const colors = ['#FF6B35', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'];

            selectedThemes.forEach((themeId, index) => {
                const theme = themes.find(t => t.id === themeId);
                const amount = budgetAllocations[themeId] || 0;
                if (amount > 0) {
                    labels.push(theme.name);
                    data.push(amount);
                }
            });

            if (budgetAllocations['overig'] && budgetAllocations['overig'] > 0) {
                labels.push('Overig');
                data.push(budgetAllocations['overig']);
            }

            if (uitgavenChart) {
                uitgavenChart.destroy();
            }

            if (data.length > 0) {
                uitgavenChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: labels,
                        datasets: [{
                            data: data,
                            backgroundColor: colors,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.label + ': ‚Ç¨' + context.parsed.toFixed(1) + 'B';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function resetBudget() {
            selectedThemes = [];
            budgetAllocations = {};
            comparisonMode = false;
            
            document.getElementById('comparisonBtn').textContent = 'üëÅÔ∏è Toon Werkelijke Begroting';
            document.getElementById('comparisonBtn').classList.remove('btn-secondary');
            document.getElementById('comparisonBtn').classList.add('btn-primary');
            
            renderThemes();
            renderBudgetSliders();
            updateBalanceDisplay();
            updateChart();
        }

        function toggleComparison() {
            comparisonMode = !comparisonMode;
            const btn = document.getElementById('comparisonBtn');
            
            if (comparisonMode) {
                btn.textContent = '‚ùå Verberg Werkelijke Begroting';
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
            } else {
                btn.textContent = 'üëÅÔ∏è Toon Werkelijke Begroting';
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-primary');
            }
            
            renderThemes();
            renderBudgetSliders();
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Colors
            const primaryColor = [255, 107, 53]; // Orange
            const secondaryColor = [47, 84, 235]; // Blue
            const textColor = [51, 51, 51]; // Dark gray
            const lightGray = [248, 249, 250];
            
            // Header with colored background
            doc.setFillColor(...primaryColor);
            doc.rect(0, 0, 210, 40, 'F');
            
            // Title
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(24);
            doc.setFont('helvetica', 'bold');
            doc.text('Budget Balancer', 20, 25);
            
            doc.setFontSize(14);
            doc.setFont('helvetica', 'normal');
            doc.text('Mijn Ideale Rijksbegroting 2026', 20, 35);
            
            // Date and info
            doc.setTextColor(...textColor);
            doc.setFontSize(10);
            doc.text(`Gegenereerd op: ${new Date().toLocaleDateString('nl-NL')} om ${new Date().toLocaleTimeString('nl-NL')}`, 20, 50);
            
            // Financial summary box
            const totaalUitgaven = Object.values(budgetAllocations).reduce((sum, amount) => sum + amount, 0);
            const totaalInkomsten = inkomsten.reduce((sum, item) => sum + item.bedrag, 0);
            const resultaat = totaalInkomsten - totaalUitgaven;
            
            // Background box for summary
            doc.setFillColor(...lightGray);
            doc.roundedRect(15, 60, 180, 45, 5, 5, 'F');
            
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.setTextColor(...primaryColor);
            doc.text('FINANCIEEL OVERZICHT', 20, 75);
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...textColor);
            doc.text(`Totale Uitgaven: EUR ${totaalUitgaven.toFixed(1)} miljard`, 20, 85);
            doc.text(`Totale Inkomsten: EUR ${totaalInkomsten.toFixed(1)} miljard`, 20, 95);
            
            // Result with color coding
            const resultColor = Math.abs(resultaat) < 1 ? secondaryColor : (resultaat > 0 ? [82, 196, 26] : [255, 71, 87]);
            doc.setTextColor(...resultColor);
            doc.setFont('helvetica', 'bold');
            doc.text(`Resultaat: EUR ${resultaat >= 0 ? '+' : ''}${resultaat.toFixed(1)} miljard`, 20, 105);
            
            let yPosition = 125;
            
            // Selected themes section
            if (selectedThemes.length > 0) {
                doc.setTextColor(...primaryColor);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('GEKOZEN THEMAS', 20, yPosition);
                yPosition += 15;
                
                selectedThemes.forEach((themeId, index) => {
                    const theme = themes.find(t => t.id === themeId);
                    const amount = budgetAllocations[themeId] || 0;
                    
                    // Colored bullet point
                    const colors = [
                        [255, 107, 53], [78, 205, 196], [69, 183, 209], 
                        [150, 206, 180], [255, 234, 167], [221, 160, 221]
                    ];
                    doc.setFillColor(...colors[index % colors.length]);
                    doc.circle(25, yPosition - 2, 2, 'F');
                    
                    doc.setTextColor(...textColor);
                    doc.setFontSize(11);
                    doc.setFont('helvetica', 'normal');
                    doc.text(`${theme.name}`, 35, yPosition);
                    
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(...primaryColor);
                    doc.text(`EUR ${amount.toFixed(1)} miljard`, 140, yPosition);
                    
                    yPosition += 12;
                });
                
                // Overig category
                if (budgetAllocations['overig'] && budgetAllocations['overig'] > 0) {
                    doc.setFillColor(128, 128, 128);
                    doc.circle(25, yPosition - 2, 2, 'F');
                    
                    doc.setTextColor(...textColor);
                    doc.setFont('helvetica', 'normal');
                    doc.text('Overig', 35, yPosition);
                    
                    doc.setFont('helvetica', 'bold');
                    doc.setTextColor(...primaryColor);
                    doc.text(`EUR ${budgetAllocations['overig'].toFixed(1)} miljard`, 140, yPosition);
                    
                    yPosition += 20;
                }
            }
            
            // Comparison section (if active)
            if (comparisonMode && selectedThemes.length > 0) {
                yPosition += 10;
                
                // Background box for comparison
                doc.setFillColor(230, 247, 255);
                doc.roundedRect(15, yPosition - 5, 180, Math.min(selectedThemes.length * 12 + 25, 80), 5, 5, 'F');
                
                doc.setTextColor(...secondaryColor);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('VERGELIJKING MET WERKELIJKE BEGROTING', 20, yPosition + 10);
                yPosition += 25;
                
                const totaalWerkelijk = selectedThemes.reduce((sum, themeId) => {
                    const theme = themes.find(t => t.id === themeId);
                    return sum + theme.realBudget;
                }, 0) + (budgetAllocations['overig'] ? calculateOverigRealBudget() : 0);
                
                const verschilTotaal = totaalUitgaven - totaalWerkelijk;
                
                doc.setTextColor(...textColor);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(`Werkelijk totaal (gekozen themas): EUR ${totaalWerkelijk.toFixed(1)} miljard`, 20, yPosition);
                
                const verschilColor = verschilTotaal >= 0 ? [82, 196, 26] : [255, 71, 87];
                doc.setTextColor(...verschilColor);
                doc.setFont('helvetica', 'bold');
                doc.text(`Jouw verschil: EUR ${verschilTotaal >= 0 ? '+' : ''}${verschilTotaal.toFixed(1)} miljard`, 20, yPosition + 10);
                yPosition += 25;
                
                // Individual theme differences (max 5 to fit on page)
                const maxThemes = Math.min(selectedThemes.length, 5);
                for (let i = 0; i < maxThemes; i++) {
                    const themeId = selectedThemes[i];
                    const theme = themes.find(t => t.id === themeId);
                    const jouwBudget = budgetAllocations[themeId] || 0;
                    const verschil = jouwBudget - theme.realBudget;
                    
                    if (yPosition > 250) break; // Prevent overflow
                    
                    doc.setTextColor(...textColor);
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'normal');
                    doc.text(`${theme.name.substring(0, 35)}:`, 25, yPosition);
                    
                    const diffColor = Math.abs(verschil) < 0.5 ? textColor : (verschil >= 0 ? [82, 196, 26] : [255, 71, 87]);
                    doc.setTextColor(...diffColor);
                    doc.setFont('helvetica', 'bold');
                    doc.text(`${verschil >= 0 ? '+' : ''}EUR ${verschil.toFixed(1)}B`, 130, yPosition);
                    
                    yPosition += 10;
                }
            }
            
            // Footer with styling
            doc.setDrawColor(...primaryColor);
            doc.setLineWidth(0.5);
            doc.line(20, 280, 190, 280);
            
            doc.setTextColor(128, 128, 128);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'italic');
            doc.text('Gegenereerd door Budget Balancer - Rijksbegroting Simulator', 20, 290);
            doc.text('Voor HBO Bedrijfskunde studenten', 20, 296);
            
            doc.save('mijn-rijksbegroting-2026.pdf');
        }

        // Initialize the app when page loads
        window.addEventListener('load', initApp);
    </script>
</body>
</html>